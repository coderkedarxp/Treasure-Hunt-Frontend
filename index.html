<!DOCTYPE html>
<html>
<head>
    <title>Multiplayer Game</title>
    <style>
        #game { display: none; }
        #output { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="login">
        <h1>Join the Game</h1>
        <input type="text" id="username" placeholder="Enter your username" />
        <button onclick="joinGame()">Join</button>
    </div>
    <div id="game">
        <h1>Game On!</h1>
        <p>Move: 
            <button onclick="sendMove('up')">Up</button>
            <button onclick="sendMove('down')">Down</button>
            <button onclick="sendMove('left')">Left</button>
            <button onclick="sendMove('right')">Right</button>
        </p>
        <pre id="output"></pre>
    </div>
    <script>
        let ws;
        const loginDiv = document.getElementById("login");
        const gameDiv = document.getElementById("game");
        const output = document.getElementById("output");

        function joinGame() {
            const username = document.getElementById("username").value.trim();
            if (!username) {
                alert("Please enter a username!");
                return;
            }

            ws = new WebSocket("wss://treasure-hunt-game-qvvk.onrender.com"); 

            ws.onopen = function() {
                // Send username to server
                ws.send(JSON.stringify({ type: "join", username: username }));
                loginDiv.style.display = "none";
                gameDiv.style.display = "block";
            };

            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.type === "update") {
                    output.textContent = "Players:\n" + JSON.stringify(data.players, null, 2);
                } else if (data.type === "win") {
                    output.textContent = `${data.winner} won the game!`;
                }
            };

            ws.onerror = function(error) {
                console.error("WebSocket error:", error);
                output.textContent = "Connection failed. Try again.";
            };

            ws.onclose = function() {
                output.textContent = "Disconnected from server.";
                gameDiv.style.display = "none";
                loginDiv.style.display = "block";
            };
        }

        function sendMove(direction) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: "move", direction: direction }));
            }
        }
    </script>
</body>
</html>